{% extends 'base.html' %}
{% load static %}
{% block content %}


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" /> 
<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script> 

<link rel="stylesheet" href="{% static 'css/style.css' %}">

<br><br>
<!--Hero-->
<div class="container">
    <div id="carouselExampleCaptions" class="carousel slide fixed-size-carousel" data-bs-ride="carousel">
        <div class="carousel-indicators">
            <button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
            <button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="1" aria-label="Slide 2"></button>
            <button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="2" aria-label="Slide 3"></button>
        </div>
        <div class="carousel-inner">
            <div class="carousel-item active">
                <img src="{% static 'img/promo3.gif' %}" class="d-block w-100" alt="...">
                <div class="carousel-caption d-none d-md-block">
                    <h5>Summer Sale!!</h5>
                    <p>Do 60% procent taniej.</p>
                </div>
            </div>
            <div class="carousel-item">
                <img src="{% static 'img/hero_example2.jpg' %}" class="d-block w-100" alt="...">
                <div class="carousel-caption d-none d-md-block">
                    <h5>Second slide label</h5>
                    <p>Some representative placeholder content for the second slide.</p>
                </div>
            </div>
            <div class="carousel-item">
                <img src="{% static 'img/hero_example3.jpg' %}" class="d-block w-100" alt="...">
                <div class="carousel-caption d-none d-md-block">
                    <h5>Third slide label</h5>
                    <p>Some representative placeholder content for the third slide.</p>
                </div>
            </div>
        </div>
        <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Previous</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Next</span>
        </button>
    </div>
</div>

<br><br>

<!-- CATEGORIES SECTION - Swiper Slider with outside buttons -->
<div class="container">
    <header class="text-center">
        <h2 class="h5 text-uppercase mb-4">Nasza oferta</h2>
    </header>

    <div class="swiper-container-wrapper swiper-categories-wrapper">
        <div class="swiper swiper-categories">
            <div class="swiper-wrapper">
                {% if categories %}
                {% for category in categories %}
                <div class="swiper-slide">
                    <a href="{% url 'category' category.name %}" class="category-item text-decoration-none text-dark d-block text-center">
                        <strong class="category-item-title d-block mb-2">{{ category.name }}</strong>
                        <div class="category-img-container">
                            {% if category.image %}
                                <img class="category-img" src="{{ category.image.url }}" alt="{{ category.name }}">
                            {% else %}
                                <img class="category-img" src="{% static 'img/placeholder_category.png' %}" alt="{{ category.name }} Placeholder">
                            {% endif %}
                        </div>
                    </a>
                </div>
                {% endfor %}
                {% else %}
                <div class="swiper-slide text-center">
                    <p>No categories available yet.</p>
                </div>
                {% endif %}
            </div>
        </div> 
        <div class="swiper-button-next swiper-button-next-categories"></div>
        <div class="swiper-button-prev swiper-button-prev-categories"></div>
    </div>
</div>
<br><br>


<!-- items Section - Swiper Slider with outside buttons -->
<div class="container">
    <header class="text-center">
        <p class="small text-muted small text-uppercase mb-1">Nasze bestsellery</p>
    </header>
    <br><br>

    <div class="swiper-container-wrapper swiper-items-wrapper">
        <div class="swiper swiper-items">
            <div class="swiper-wrapper">
                {% for product in products %}
                <div class="swiper-slide">
                    <div class="product text-center">
                        <div class="mb-3 position-relative">
                            <div class="badge text-white badge-"></div>
                            <a class="d-block" href="{% url 'product' product.id  %}">
                                {% if product.images.all %}
                                <div id="productCardCarousel-{{ product.id }}" class="carousel slide card-product-carousel" data-bs-ride="false" data-bs-interval="false">
                                    <div class="carousel-inner">
                                        {% for image_obj in product.images.all %}
                                        <div class="carousel-item {% if forloop.first %}active{% endif %}">
                                            <img src="{{ image_obj.image.url }}" class="d-block w-100 carousel-img" alt="{{ image_obj.alt_text|default:product.name }}">
                                        </div>
                                        {% endfor %}
                                    </div>
                                </div>
                                {% else %}
                                <img src="{% static 'img/kolczyki.png' %}" class="img-fluid w-100 card-fallback-img" alt="Brak zdjęcia dla produktu">
                                {% endif %}
                            </a>
                        </div>
                        <div class="product-info">
                            <a href="{% url 'product' product.id %}" style="text-decoration: none; color: inherit;">
                                <h6 class="product-name">{{ product.name }}</h6>
                            </a>
                            {% if product.is_sale %}
                            <p class="product-sale-price" color=""> {{ product.sale_price }} zł</p>
                            <br>
                            <p class="small text-muted product-sale-price">Cena regularna: {{ product.price }} zł</p>
                            <p class="small text-muted product-sale-price lowest-price-line">Najniższa cena z 30 dni: {{ product.sale_price }} zł</p>
                            {% else %}
                            <p class="small text-muted product-price">{{ product.price }} zł</p>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            <br>
            <div class="swiper-pagination"></div>
        </div>
        <div class="swiper-button-next swiper-button-next-items"></div>
        <div class="swiper-button-prev swiper-button-prev-items"></div>
    </div>
</div>


<script>
    document.addEventListener('DOMContentLoaded', function() {

        // Inicjalizacja Swipera dla Kategorii
        const swiperCategories = new Swiper('.swiper-categories', {
            direction: 'horizontal',
            loop: true,
            grabCursor: true,
            breakpoints: {
                0: { slidesPerView: 1, spaceBetween: 10 },
                576: { slidesPerView: 2, spaceBetween: 20 },
                768: { slidesPerView: 3, spaceBetween: 30 },
                992: { slidesPerView: 3, spaceBetween: 40 },
                1200: { slidesPerView: 3, spaceBetween: 40 }
            },
            navigation: {
                nextEl: '.swiper-button-next-categories',
                prevEl: '.swiper-button-prev-categories',
            },
            pagination: {
                el: '.swiper-categories .swiper-pagination',
                clickable: true,
            },
             a11y: {
              enabled: true,
              prevSlideMessage: 'Poprzednia kategoria',
              nextSlideMessage: 'Następna kategoria',
              paginationBulletMessage: 'Przejdź do kategorii {{index}}',
            },
        });

        // Inicjalizacja Swipera dla Produktów
        const swiperItems = new Swiper('.swiper-items', {
            direction: 'horizontal',
            loop: true,
            grabCursor: true,
             breakpoints: {
                 0: { slidesPerView: 1, spaceBetween: 10 },
                576: { slidesPerView: 2, spaceBetween: 20 },
                768: { slidesPerView: 3, spaceBetween: 30 },
                992: { slidesPerView: 4, spaceBetween: 40 }
            },
            navigation: {
                nextEl: '.swiper-button-next-items',
                prevEl: '.swiper-button-prev-items',
            },
            pagination: {
                el: '.swiper-items .swiper-pagination',
                clickable: true,
            },
             a11y: {
              enabled: true,
              prevSlideMessage: 'Poprzedni produkt',
              nextSlideMessage: 'Następny produkt',
              paginationBulletMessage: 'Przejdź do produktu {{index}}',
            },
        });

        // --- ZASTOSOWANO SPRAWDZONY KOD: EFEKT ZMIANY ZDJĘCIA PO NAJECHANIU ---
        const productCards = document.querySelectorAll('.swiper-items .product');
        productCards.forEach(card => {
            const carousel = card.querySelector('.card-product-carousel');
            if (carousel) {
                const firstItem = carousel.querySelector('.carousel-item:first-child');
                const secondItem = carousel.querySelector('.carousel-item:nth-child(2)');

                // Dodaj listenery tylko jeśli są co najmniej 2 zdjęcia
                if (firstItem && secondItem) {
                    card.addEventListener('mouseenter', () => {
                        firstItem.classList.remove('active');
                        secondItem.classList.add('active');
                    });

                    card.addEventListener('mouseleave', () => {
                        secondItem.classList.remove('active');
                        firstItem.classList.add('active');
                    });
                }
            }
        });

    }); // Koniec DOMContentLoaded
</script>

{% endblock %}
